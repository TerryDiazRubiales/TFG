{"ast":null,"code":"import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { computed, inject, signal } from '@angular/core';\nimport { catchError, map, of, throwError } from 'rxjs';\nimport { environments } from 'src/environments/environments';\nimport { AuthStatus } from '../interfaces';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.baseUrl = environments.baseUrl;\n    this.http = inject(HttpClient);\n    this._currentUser = signal(null);\n    this._authStatus = signal(AuthStatus.checking);\n    this.currentUser = computed(() => this._currentUser());\n    this.authStatus = computed(() => this._authStatus());\n    this.checkAuthStatus().subscribe();\n  }\n  setAuthentication(user, token) {\n    this._currentUser.set(user);\n    this._authStatus.set(AuthStatus.authenticated);\n    localStorage.setItem('token', token);\n    0;\n    return true;\n  }\n  login(email, password) {\n    const url = `${this.baseUrl}/auth/login`;\n    const body = {\n      email,\n      password\n    };\n    return this.http.post(url, body).pipe(map(({\n      user,\n      token\n    }) => this.setAuthentication(user, token)), catchError(err => throwError(() => err.error.message)));\n  }\n  checkAuthStatus() {\n    const url = `${this.baseUrl}/auth/check-token`;\n    const token = localStorage.getItem('token');\n    if (!token) return of(false);\n    const headers = new HttpHeaders().set('Authorization', `Bearer ${token}`);\n    return this.http.get(url, {\n      headers\n    }).pipe(map(({\n      token,\n      user\n    }) => this.setAuthentication(user, token)), catchError(() => {\n      this._authStatus.set(AuthStatus.notAuthenticated);\n      return of(false);\n    }));\n  }\n  static #_ = this.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)();\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["HttpClient","HttpHeaders","computed","inject","signal","catchError","map","of","throwError","environments","AuthStatus","AuthService","constructor","baseUrl","http","_currentUser","_authStatus","checking","currentUser","authStatus","checkAuthStatus","subscribe","setAuthentication","user","token","set","authenticated","localStorage","setItem","login","email","password","url","body","post","pipe","err","error","message","getItem","headers","get","notAuthenticated","_","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\aidal\\OneDrive\\Escritorio\\PF_TDR\\authApp\\src\\app\\auth\\services\\auth.service.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Injectable, computed, inject, signal } from '@angular/core';\nimport { Observable, catchError, map, of, tap, throwError } from 'rxjs';\nimport { environments } from 'src/environments/environments';\n\nimport { AuthStatus, CheckTokenResponse, LoginResponse, User } from '../interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n\n  private readonly baseUrl: string = environments.baseUrl;\n  private http = inject( HttpClient );\n\n  private _currentUser = signal<User|null>(null);\n  private _authStatus = signal<AuthStatus>( AuthStatus.checking );\n \n  public currentUser = computed( () => this._currentUser() );\n  public authStatus = computed( () => this._authStatus() );\n\n  constructor() { \n    this.checkAuthStatus().subscribe();\n  }\n\n  private setAuthentication(user: User, token: string): boolean {\n\n    this._currentUser.set( user );\n        this._authStatus.set( AuthStatus.authenticated );\n        localStorage.setItem('token', token);\n        0\n        return true;\n  }\n\n\n  login( email: string, password: string): Observable<boolean> {\n\n    const url = `${ this.baseUrl }/auth/login`;\n    const body = { email, password };\n\n    return this.http.post<LoginResponse>( url, body)\n    .pipe (\n      map ( ({ user, token }) => this.setAuthentication(user, token )),\n      catchError( err  => throwError( () => err.error.message ))\n    );\n  }\n\n  checkAuthStatus():Observable<boolean> {\n\n    const url = `${ this.baseUrl }/auth/check-token`;\n    const token = localStorage.getItem('token');\n\n    if ( !token ) return of(false);\n\n    const headers = new HttpHeaders()\n    .set('Authorization', `Bearer ${ token }`);\n\n    return this.http.get<CheckTokenResponse>(url, { headers })\n    .pipe(\n      map(( { token, user } ) => this.setAuthentication( user, token )),\n\n      catchError( () => {\n        this._authStatus.set( AuthStatus.notAuthenticated );\n        return of(false);\n      })\n    )\n    \n  }\n\n}\n"],"mappings":"AAAA,SAASA,UAAU,EAAEC,WAAW,QAAQ,sBAAsB;AAC9D,SAAqBC,QAAQ,EAAEC,MAAM,EAAEC,MAAM,QAAQ,eAAe;AACpE,SAAqBC,UAAU,EAAEC,GAAG,EAAEC,EAAE,EAAOC,UAAU,QAAQ,MAAM;AACvE,SAASC,YAAY,QAAQ,+BAA+B;AAE5D,SAASC,UAAU,QAAiD,eAAe;;AAKnF,OAAM,MAAOC,WAAW;EAWtBC,YAAA;IATiB,KAAAC,OAAO,GAAWJ,YAAY,CAACI,OAAO;IAC/C,KAAAC,IAAI,GAAGX,MAAM,CAAEH,UAAU,CAAE;IAE3B,KAAAe,YAAY,GAAGX,MAAM,CAAY,IAAI,CAAC;IACtC,KAAAY,WAAW,GAAGZ,MAAM,CAAcM,UAAU,CAACO,QAAQ,CAAE;IAExD,KAAAC,WAAW,GAAGhB,QAAQ,CAAE,MAAM,IAAI,CAACa,YAAY,EAAE,CAAE;IACnD,KAAAI,UAAU,GAAGjB,QAAQ,CAAE,MAAM,IAAI,CAACc,WAAW,EAAE,CAAE;IAGtD,IAAI,CAACI,eAAe,EAAE,CAACC,SAAS,EAAE;EACpC;EAEQC,iBAAiBA,CAACC,IAAU,EAAEC,KAAa;IAEjD,IAAI,CAACT,YAAY,CAACU,GAAG,CAAEF,IAAI,CAAE;IACzB,IAAI,CAACP,WAAW,CAACS,GAAG,CAAEf,UAAU,CAACgB,aAAa,CAAE;IAChDC,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEJ,KAAK,CAAC;IACpC,CAAC;IACD,OAAO,IAAI;EACjB;EAGAK,KAAKA,CAAEC,KAAa,EAAEC,QAAgB;IAEpC,MAAMC,GAAG,GAAG,GAAI,IAAI,CAACnB,OAAQ,aAAa;IAC1C,MAAMoB,IAAI,GAAG;MAAEH,KAAK;MAAEC;IAAQ,CAAE;IAEhC,OAAO,IAAI,CAACjB,IAAI,CAACoB,IAAI,CAAiBF,GAAG,EAAEC,IAAI,CAAC,CAC/CE,IAAI,CACH7B,GAAG,CAAG,CAAC;MAAEiB,IAAI;MAAEC;IAAK,CAAE,KAAK,IAAI,CAACF,iBAAiB,CAACC,IAAI,EAAEC,KAAK,CAAE,CAAC,EAChEnB,UAAU,CAAE+B,GAAG,IAAK5B,UAAU,CAAE,MAAM4B,GAAG,CAACC,KAAK,CAACC,OAAO,CAAE,CAAC,CAC3D;EACH;EAEAlB,eAAeA,CAAA;IAEb,MAAMY,GAAG,GAAG,GAAI,IAAI,CAACnB,OAAQ,mBAAmB;IAChD,MAAMW,KAAK,GAAGG,YAAY,CAACY,OAAO,CAAC,OAAO,CAAC;IAE3C,IAAK,CAACf,KAAK,EAAG,OAAOjB,EAAE,CAAC,KAAK,CAAC;IAE9B,MAAMiC,OAAO,GAAG,IAAIvC,WAAW,EAAE,CAChCwB,GAAG,CAAC,eAAe,EAAE,UAAWD,KAAM,EAAE,CAAC;IAE1C,OAAO,IAAI,CAACV,IAAI,CAAC2B,GAAG,CAAqBT,GAAG,EAAE;MAAEQ;IAAO,CAAE,CAAC,CACzDL,IAAI,CACH7B,GAAG,CAAC,CAAE;MAAEkB,KAAK;MAAED;IAAI,CAAE,KAAM,IAAI,CAACD,iBAAiB,CAAEC,IAAI,EAAEC,KAAK,CAAE,CAAC,EAEjEnB,UAAU,CAAE,MAAK;MACf,IAAI,CAACW,WAAW,CAACS,GAAG,CAAEf,UAAU,CAACgC,gBAAgB,CAAE;MACnD,OAAOnC,EAAE,CAAC,KAAK,CAAC;IAClB,CAAC,CAAC,CACH;EAEH;EAAC,QAAAoC,CAAA,G;qBAzDUhC,WAAW;EAAA;EAAA,QAAAiC,EAAA,G;WAAXjC,WAAW;IAAAkC,OAAA,EAAXlC,WAAW,CAAAmC,IAAA;IAAAC,UAAA,EAFV;EAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}